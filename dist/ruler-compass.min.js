/*! ruler-compass - v0.0.0 - 2013-01-09
 * https://github.com/dvberkel/ruler-compass
 * Copyright (c) 2013 Daan van Berkel; Licensed MIT
 */
Geometry={version:"0.0.0"},function(e,t,n){var r=function(e){var t=0;this.nextName=function(){return e+t++}},i=t.Model.extend({defaults:{type:"point",x:0,y:0},updateFromResult:function(e){this.set(e),this.trigger("updatedFromResult")}}),s=t.Model.extend({defaults:{type:"line",P0:"A",P1:"B"}}),o=t.Model.extend({name:function(e){e&&this.set("name",e);if(!this.has("name")){var t=this;this.trigger("request:name",t.object().get("type"),function(e){t.name(e)})}return e||this.get("name")},point:function(){return this.has("point")||this.set("point",new i),this.get("point")},object:function(){return this.get("object")}}),u=t.Collection.extend({model:o,initialize:function(){this.generators={point:new r("P"),line:new r("l")}},append:function(e){e.on("request:name",this.provideName,this),this.add(e)},provideName:function(e,t){t.call(null,this.generators[e].nextName())},firstPoints:function(e){var t={},n=0;return this.filter(function(e){return e.object().get("type")==="point"}).reduce(function(e,t){return e["P"+n++]=t.name(),e},t),t}});n.Point=i,n.Line=s,n.ConstructionStep=o,n.Construction=u}(_,Backbone,Geometry),function(e,t,n,r,i){var s=n.View.extend({initialize:function(){this.model||(this.model=new i.Construction),this.render()},render:function(){new o({el:this.$el,model:this.model}),new c({el:this.$el,model:this.model}),new y({el:this.$el,model:this.model})}}),o=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<div class='parts'/>");t.appendTo(this.$el),new u({el:t,model:this.model}),new f({el:t,model:this.model})}}),u=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<div class='free'/>");t.appendTo(this.$el),new a({el:t,model:this.model})}}),a=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<span class='point'>Point</span>");t.appendTo(this.$el);var n=this.model;t.click(function(){n.append(new i.ConstructionStep({object:new i.Point}))})}}),f=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<div class='constructions'/>");t.appendTo(this.$el),new l({el:t,model:this.model})}}),l=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<span class='line'>Line</span>");t.appendTo(this.$el);var n=this.model;t.click(function(){var e=n.firstPoints(2);n.append(new i.ConstructionStep({object:new i.Line(e)}))})}}),c=n.View.extend({initialize:function(){this.model.on("add",function(e){var t=this.container();new h({el:t,model:e})},this),this.render()},render:function(){var e=this.container()},container:function(){return this._container===undefined&&(this._container=e("<div class='code'/>"),this._container.appendTo(this.$el)),this._container}}),h=n.View.extend({template:t.template("<div class='<%= type %>'/>"),initialize:function(){this.render()},render:function(){var e=this.container();new p({el:e,model:this.model}),new v({el:e,model:this.model})},container:function(){return this._container===undefined&&(this._container=e(this.template(this.model.object().toJSON())),this._container.appendTo(this.$el)),this._container}}),p=n.View.extend({initialize:function(){this.render()},render:function(){var e=this.container();new d({el:e,model:this.model})},container:function(){return this._container===undefined&&(this._container=e("<span class='names'/>"),this._container.appendTo(this.$el)),this._container}}),d=n.View.extend({initialize:function(){this.render()},render:function(){var e=this.container();e.empty().text(this.model.name())},container:function(){return this._container===undefined&&(this._container=e("<span class='name'/>"),this._container.appendTo(this.$el)),this._container}}),v=n.View.extend({initialize:function(){this.descriptions={point:m,line:g},this.render()},render:function(){var e=this.container();new(this.descriptions[this.model.object().get("type")])({model:this.model.object(),el:e})},container:function(){return this._container===undefined&&(this._container=e("<span class='description'/>"),this._container.appendTo(this.$el)),this._container}}),m=n.View.extend({template:t.template("<span class='free-point'>(<span class='coordinate x'><%= x %></span>,<span class='coordinate y'><%= y %></span>)</span>"),initialize:function(){this.render(),this.model.on("updatedFromResult",this.render,this)},render:function(){var e=this.container();e.find(".x").text(this.model.get("x")),e.find(".y").text(this.model.get("y"))},container:function(){return this._container===undefined&&(this._container=e(this.template(this.model.toJSON())),this._container.appendTo(this.$el)),this._container}}),g=n.View.extend({template:t.template("<span class='line'>l(<span class='reference-point'><%= P0 %></span>,<span class='reference-point'><%= P1 %></span>)</span>"),initialize:function(){this.render()},render:function(){var e=this.container()},container:function(){return this._container===undefined&&(this._container=e(this.template(this.model.toJSON())),this._container.appendTo(this.$el)),this._container}}),y=n.View.extend({initialize:function(){this.render()},render:function(){var e=this.container();new b({model:this.model,el:e})},container:function(){return this._container===undefined&&(this._container=e("<div class='result' id='result'/>"),this._container.appendTo(this.$el)),this._container}}),b=n.View.extend({initialize:function(){this.model.on("add",function(e){var t=this.paper();new E({model:e,paper:t})},this),this.render()},render:function(){var e=this.paper();new w({model:this.model,paper:e})},paper:function(){return this._paper===undefined&&(this._paper=new r(this.$el.attr("id"),640,480),this._paper.setViewBox(-320,-240,640,480)),this._paper}}),w=n.View.extend({initialize:function(){this.render()},render:function(){var e=this.paper();e.path("M-320,0L640,0").attr({stroke:"black"}),e.path("M0,-240L0,480").attr({stroke:"black"})},paper:function(){return this.options.paper}}),E=n.View.extend({initialize:function(){this.render()},render:function(){var e=this.point(),t=this.model.object();e.attr({cx:t.get("x"),cy:t.get("y")})},point:function(){if(this._point===undefined){var e=this.paper();this._point=e.circle(0,0,3).attr({stroke:"black",fill:"black"}),this._point.node.setAttribute("class","point"),this._point.drag(function(e,t){var n=this.ox+e,r=this.oy+t;this.model.object().updateFromResult({x:n,y:r}),this.point().attr({cx:n,cy:r})},function(e,t){var n=this.point();this.ox=n.attr("cx"),this.oy=n.attr("cy")},function(){},this,this,this)}return this._point},paper:function(){return this.options.paper}});i.EnvironmentView=s}(jQuery,_,Backbone,Raphael,Geometry);